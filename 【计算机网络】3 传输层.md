---
author: [Even]
date: [2025年10月01日]
update: [2025年10月01日]
title: [【计算机网络】3 传输层]
tags: [计算机网络, 传输层, TCP, UDP]
---

# 3.1 概述和传输层服务
- 网络层：主机之间的逻辑通信
- 传输层：进程之间的逻辑通信
- TCP/UDP均不提供
    - 时延保证
    - 带宽保证

# 3.2 多路复用和解复用
- TCP的复用与解复用
    - Socket
    - Message
    - Segment
    - 逐级封装，源端复用，目标端解复用
    - 目标一致，但源不同，则传输到不同的应用进程

``` mermaid
---
title: "TCP Packet"
---
packet
0-15: "Source Port"
16-31: "Destination Port"
32-63: "Sequence Number"
64-95: "Acknowledgment Number"
96-99: "Data Offset"
100-105: "Reserved"
106: "URG"
107: "ACK"
108: "PSH"
109: "RST"
110: "SYN"
111: "FIN"
112-127: "Window"
128-143: "Checksum"
144-159: "Urgent Pointer"
160-191: "(Options and Padding)"
192-255: "Data (variable length)"
```

- UDP的复用与解复用
    - 本地IP
    - 本地Port
    - 目标IP
    - 目标Port
    - 目标一致，无论谁发送都传输到同一个进程

``` mermaid
packet
title UDP Packet
+16: "Source Port"
+16: "Destination Port"
32-47: "Length"
48-63: "Checksum"
64-95: "Data (variable length)"
```

# 3.3 无连接传输UDP
- User Datagram Protocol
    - 无连接
    - 不握手
    - 报文乱序（不保序）
- 应用于
    - 流媒体
    - DNS
    - SNMP
- 补充EDC校验等
    - EDC与数据一起出错，但仍满足编码关系：残存错误
    - 校验和校验
    - 不提供差错恢复

# 3.4 可靠数据传输的原理
- 可靠数据传输的底层为UDP
- Reliable Data Transfer（RDT）
- FSM有限状态机实现发送接收过程
    - 发送分组`packet`，接收分组`packet`，接收端校验后回复ACK或NAK
    - 接收端等待一个分组`packet`，但预期可能
    - 每次发送一个分组后等待，为`Stop-and-Wait`模式
    - 在分组前加上分组序号，以便区分分组到达时间
    - 等待`packet0`，来了`packet1`，则无效，需重新发送ACK
    - 目的是回到同步状态
    - 仅有一次ACK/NAK，并没有对ACK/NAK的ACK/NAK，因为不具备完备性
    - 所以分析下次到达的分组情况，判定是否被确认，假设已发送`packet0`的ACK
        - 下次接收到`packet0`？则ACK错误
        - 下次接收到`packet1`？则ACK正确
    - 对ACK/NAK编号，则可知道哪个分组未被正确传输
    - 传输后还需进行EDC校验
    - 发送方超时重传机制，防止相互等待ACK/packet卡死
        - 数据链路层，概率分布集中则确定一个时间
        - 经过传输层，则设置为自适应时间
        - EDC校验不通过，则也可通过ACK超时重发