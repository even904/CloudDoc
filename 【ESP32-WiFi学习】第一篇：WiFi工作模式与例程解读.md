---
author: [Even]
date: [2024年12月29日]
update: [2025年01月02日]
title: [【ESP32-WiFi学习】第一篇：WiFi工作模式与例程解读]
tags: [ESP32,WiFi,ESP-IDF,Mode]
---

# 【ESP32-WiFi学习】第一篇：工作模式

## 概述
> -   station 模式（即 STA 模式或 Wi-Fi 客户端模式），此时 ESP32 连接到接入点 (AP)。
> 
> -    AP 模式（即 Soft-AP 模式或接入点模式），此时基站连接到 ESP32。
> 
> -    station/AP 共存模式（ESP32 既是接入点，同时又作为基站连接到另外一个接入点）。
> 
> -    上述模式的各种安全模式（WPA、WPA2、WPA3 等）。
> 
> -    扫描接入点（包括主动扫描及被动扫描）。
> 
> -    使用混杂模式监控 IEEE802.11 Wi-Fi 数据包。

## 学习目标
回答以下问题：
ESP32支持的WiFi工作模式有哪些？每种模式的特点是什么？
ESP32的WiFi支持的标准、通信频率、信道带宽、通信速率等参数？

## ESP32支持的WiFi工作模式
### 1. Station模式
此时ESP32连接到接入点 (AP)。可以使用ESP32连接到WiFi，从而接入互联网。

在 station 例程中，需要在`MenuConfig`中配置`WiFi SSID`及`WiFi Password`，使 ESP32 可以接入该 WiFi 网络。

### 2. AP模式
AP模式类似于家用路由器的工作模式，使得其他Wi-Fi设备可以像连接到普通路由器一样连接到这个设备。如果ESP32本身接入了Ethernet从而可以提供互联网访问，则其他设备接入后可通过该网络上网，否则就只是接入了一个局域网。

ESP32没有没有独立的、专门针对AP功能优化的硬件组件，因此使用Soft AP，Soft AP允许设备通过软件配置来充当Wi-Fi接入点。

为ESP32配置Soft AP模式，在ESP-IDF工具链中，需要修改`MenuConfig`中的`WiFi SSID`及`WiFi Password`，从而设置ESP32作为AP时的名称和密码。ESP-IDF编译时将提取配置信息，写入代码中。



![img](https://eleceasy.com/uploads/default/optimized/2X/e/eef38b615678f67215f5f275334c357fba3b7a78_2_1024x576.jpeg)**AP与STA模式** *(图源：https://eleceasy.com)*

### 3. STA/AP共存（混合）模式

ESP32还提供了一种STA与AP同时存在的模式，此时 ESP32 既作为 STA 联网，又作为 AP 提供接入点。该模式可用于实现 Wi-Fi NAT 路由器。



## ESP32的WiFi支持的标准及相关参数

### 支持标准
> 支持使用 IEEE 802.11b、IEEE 802.11g、IEEE 802.11n

下表显示了以上标准定义的WiFi关键信息：

| 参数/特性          | 802.11b        | 802.11g        | 802.11n(WiFi4)    |
|--------------------|----------------|----------------|----------------|
| **频段 (GHz)**     | 2.4            | 2.4            | 2.4 / 5        |
| **最大数据速率**   | 11 Mbit/s      | 54 Mbit/s      | 2.4GHz:450Mbit/s<br>5GHz:600 Mbit/s     |
| **调制方式**       | DSSS           | OFDM           | OFDM, MIMO     |
| **信道带宽 (MHz)** | 22             | 20             | 20 / 40        |
| **调制技术**       | CCK, PBCC      | BPSK, QPSK, 16-QAM | BPSK, QPSK, 16-QAM, 64-QAM |
| **MIMO 支持**      | 不支持         | 不支持         | 支持           |
| **空间流数**       | 1              | 1              | 最多4          |
| **向后兼容性**     | 无             | 向后兼容802.11b | 向后兼容802.11a/b/g |
| **引入年份**       | 1999           | 2003           | 2009           |
| **典型室内范围**   | 38米 (开阔)    | 38米 (开阔)    | 70米 (开阔)    |
| **典型室外范围**   | 140米 (开阔)   | 140米 (开阔)   | 250米 (开阔)   |

空间流数：空间流是指通过不同的天线路径独立传输的数据流。每个空间流可以携带独立的信息，从而显著提高数据传输速率。在一个MIMO系统中，发送端和接收端都配备了多个天线，允许它们在同一频率资源上并行传输多个空间流。802.11n 支持最多4个空间流，这意味着它可以同时传输四个独立的数据流。

值得注意的是，802.11b在通频带两端各留出1MHz保护频带，因此信道带宽为22MHz，而后续协议采用OFDM调制，减少了对额外保护频带的需求，典型信道带宽为20MHz，频带利用率更高。

### 信道状态信息解释
**Wi-Fi 2.4 GHz频段频率范围：** 
2.400 GHz 到 2.4835 GHz
**总带宽：**
83.5 MHz (2.4835 GHz - 2.400 GHz = 83.5 MHz)
**可用信道数量：**
在2.4 GHz ISM频段内，根据不同的国家和地区规定，可用的信道数量有所不同。以下是全球范围内常见的信道划分情况：

- 1到13信道：这是许多国家（如中国、欧洲大部分地区）允许使用的信道，每个信道中心频率间隔为5 MHz。 
- 1到11信道：在美国和其他一些国家，只允许使用1到11信道。
- 1到14信道：在日本，可以使用额外的第14信道，但该信道有特殊的功率限制，并且不被广泛支持。 

典型的3个不重叠的信道是1、6、11

**辅助信道：**
通过合并两个20Hz信道形成一个40Hz信道，其中一个信道作为主信道，另一个作为辅助信道。802.11n根据信道在频带的位置规定两种组合方式：
- Above (Upper) Configuration：
主信道位于较低的20 MHz频段。
辅助信道位于较高的20 MHz频段。
- Below (Lower) Configuration：
主信道位于较高的20 MHz频段。
辅助信道位于较低的20 MHz频段。

**HT (High Throughput) 模式：**
HT模式是指支持802.11n及以上标准中的高吞吐量特性的设备和通信链路。这些特性包括但不限于MIMO、40 MHz信道带宽、更高效的调制编码方案（如64-QAM），以及更好的FEC（前向纠错）技术。HT模式旨在显著提高无线网络的数据传输速率和频谱效率。
ESP32在 STA/AP 模式下都可以支持HT模式，实际带宽在WiFi连接时协商，但只有当 station 和所连 AP 都支持 HT40 时，带宽才为 HT40，否则为 HT20。

> 在 station/AP 共存模式下，station 和 AP 都可独立配置为 HT20/40。如果 station 和 AP 都协商为 HT40，由于 ESP32 中，station 的优先级总高于 AP，HT40 信道是 station 的信道。例如，AP 的配置带宽为 HT40，配置的主信道为 6，配置的辅助信道为 10。如果，station 所连路由器的主信道为 6、辅助信道为 2，AP 的实际信道将自动更改为主 6 和辅 2。

### 实测参数

#### 吞吐量
引自[ESP32 ESP-IDF文档](https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html#id57)

| 类型/吞吐量           | 实验室空气状况 | 屏蔽箱 | 测试工具      | IDF 版本 (commit ID) |
|----------------------|---------------|--------|--------------|---------------------|
| 原始 802.11 数据包接收数据 | N/A           | 130 MBit/s | 内部工具     | N/A                 |
| 原始 802.11 数据包发送数据 | N/A           | 130 MBit/s | 内部工具     | N/A                 |
| UDP 接收数据          | 30 MBit/s     | 85 MBit/s | iperf example | 15575346             |
| UDP 发送数据          | 30 MBit/s     | 75 MBit/s | iperf example | 15575346             |
| TCP 接收数据          | 20 MBit/s     | 65 MBit/s | iperf example | 15575346             |
| TCP 发送数据          | 20 MBit/s     | 75 MBit/s | iperf example | 15575346             |



